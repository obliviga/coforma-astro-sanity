---
import { sanityClient } from "sanity:client";
import { PortableText as PortableTextInternal } from "astro-portabletext";
import BlogPost from "../../layouts/BlogPost.astro";
import type { Post } from "../../env.d.ts";

export async function getStaticPaths() {
  const posts: Post[] = await sanityClient.fetch(
    `*[_type == "post" && defined(slug.current)]`,
  );

  return posts.map((post) => ({
    params: { slug: post.slug.current },
    props: post,
  }));
}

const post = Astro.props;
---

<BlogPost {...post}>
  <PortableTextInternal value={post.body} />
</BlogPost>

<script define:vars={{ post }}>
  console.log("Astro client post slug:", post?.slug?.current);
  console.log("Astro client post:", post);
</script>
